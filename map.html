<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>지도 보기 - 밴쿠버 한인 업체 목록</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/styles.css" />
    <link rel="stylesheet" href="styles/map.css" />
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="header-content">
          <div class="header-top">
            <div class="logo">
              <a href="./index.html">
                <h1>밴쿠버 한인 업체 목록</h1>
              </a>
            </div>
            <nav class="nav">
              <a href="./index.html" class="nav-link">홈</a>
              <a href="./directory.html" class="nav-link">업체 목록</a>
              <a href="./map.html" class="nav-link active">지도</a>
              <a href="./board.html" class="nav-link">게시판</a>
              <a href="./submit.html" class="nav-link">업체 등록</a>
              <a href="./guide.html" class="nav-link">가이드</a>
              <a href="./about.html" class="nav-link">소개</a>
            </nav>
            <div class="header-controls">
              <div class="language-toggle" id="langToggle">
                <button class="lang-btn active" data-lang="ko">KO</button>
                <button class="lang-btn" data-lang="en">EN</button>
              </div>
              <button class="theme-toggle" id="themeToggle">
                <span id="themeIcon">🌙</span>
              </button>
            </div>
          </div>
          <nav class="nav mobile-nav">
            <a href="./index.html" class="nav-link">홈</a>
            <a href="./directory.html" class="nav-link">업체 목록</a>
            <a href="./map.html" class="nav-link active">지도</a>
            <a href="./board.html" class="nav-link">게시판</a>
            <a href="./submit.html" class="nav-link">업체 등록</a>
            <a href="./guide.html" class="nav-link">가이드</a>
            <a href="./about.html" class="nav-link">소개</a>
          </nav>
        </div>
      </div>
    </header>

    <!-- Top Controls -->
    <section class="map-controls">
      <div class="container">
        <div class="controls-content">
          <div class="search-section">
            <div class="search-container">
              <input type="text" class="search-input" placeholder="업체명 · 업종 · 지역 검색" id="mapSearch" />
              <button class="search-btn">검색</button>
            </div>
          </div>

          <div class="filter-section">
            <div class="category-chips">
              <button class="filter-chip active" data-category="all">전체</button>
              <button class="filter-chip" data-category="restaurant">🍜 음식점</button>
              <button class="filter-chip" data-category="grocery">🛒 마트</button>
              <button class="filter-chip" data-category="medical">🏥 병원</button>
              <button class="filter-chip" data-category="legal">⚖️ 법률/회계</button>
              <button class="filter-chip" data-category="realestate">🏠 부동산</button>
              <button class="filter-chip" data-category="beauty">💇 미용</button>
              <button class="filter-chip" data-category="education">🎓 학원</button>
            </div>

            <div class="control-buttons">
              <button class="control-btn" id="myLocationBtn">
                <span class="btn-icon">📍</span>
                내 위치로 이동
              </button>
              <button class="control-btn secondary" id="listToggleBtn">
                <span class="btn-icon">📋</span>
                리스트 보기
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Map Container -->
    <main class="map-container">
      <!-- Desktop List Panel -->
      <aside class="list-panel desktop-list" id="desktopListPanel">
        <div class="list-header">
          <h3>업체 목록</h3>
          <span class="result-count">총 <span id="mapResultCount">8</span>개</span>
        </div>
        <div class="list-content" id="desktopListContent">
          <!-- List items will be populated by JavaScript -->
        </div>
      </aside>

      <!-- Map -->
      <div class="map-wrapper">
        <div id="map"></div>
      </div>

      <!-- Mobile Bottom Sheet -->
      <div class="mobile-bottom-sheet" id="mobileBottomSheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
          <h3>업체 목록</h3>
          <span class="result-count">총 <span id="mobileResultCount">8</span>개</span>
        </div>
        <div class="sheet-content" id="mobileListContent">
          <!-- List items will be populated by JavaScript -->
        </div>
      </div>
    </main>

    <!-- Map Popup Template -->
    <div id="popupTemplate" style="display: none">
      <div class="map-popup">
        <div class="popup-image">
          <img src="" alt="" class="popup-img" />
        </div>
        <div class="popup-content">
          <h4 class="popup-name"></h4>
          <p class="popup-name-en"></p>
          <p class="popup-category"></p>
          <div class="popup-rating">
            <span class="popup-stars"></span>
            <span class="popup-rating-text"></span>
          </div>
          <p class="popup-address"></p>
          <div class="popup-status"></div>
          <button class="popup-btn" onclick="viewBusinessDetails()">자세히 보기</button>
        </div>
      </div>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" id="scrollToTop" title="맨 위로 가기">↑</button>

    <!-- Footer -->
    <footer class="footer minimal-footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>About</h4>
            <ul>
              <li><a href="#">우리 이야기</a></li>
              <li><a href="#">연락처</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Contact</h4>
            <ul>
              <li><a href="#">이메일</a></li>
              <li><a href="#">전화</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Social</h4>
            <div class="social-links">
              <a href="#" class="social-link">📱</a>
              <a href="#" class="social-link">📷</a>
              <a href="#" class="social-link">📘</a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 밴쿠버 한인 업체 목록. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="scroll-to-top">
      <span>↑</span>
    </button>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="scripts/script.js"></script>
    <script src="scripts/map.js"></script>

    <script>
      // Dark mode functionality
      document.addEventListener('DOMContentLoaded', function () {
        const themeToggle = document.getElementById('themeToggle');
        const langToggle = document.getElementById('langToggle');
        const body = document.body;
        const themeIcon = document.getElementById('themeIcon');
        const langIcon = langToggle.querySelector('span');

        // Load saved theme and language
        const savedTheme = localStorage.getItem('theme') || 'light';
        const savedLang = localStorage.getItem('language') || 'ko';

        body.setAttribute('data-theme', savedTheme);
        body.setAttribute('lang', savedLang);
        updateThemeIcon(savedTheme);
        updateLanguageIcon(savedLang);
        updateNavigation(savedLang);

        // Theme toggle event listener
        themeToggle.addEventListener('click', function () {
          const currentTheme = body.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

          body.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          updateThemeIcon(newTheme);
        });

        // Language toggle event listener
        langToggle.addEventListener('click', function (e) {
          if (e.target.classList.contains('lang-btn')) {
            const newLang = e.target.getAttribute('data-lang');

            // Update active button
            langToggle.querySelectorAll('.lang-btn').forEach((btn) => {
              btn.classList.remove('active');
            });
            e.target.classList.add('active');

            body.setAttribute('lang', newLang);
            localStorage.setItem('language', newLang);
            updateLanguageIcon(newLang);
            updateNavigation(newLang);
          }
        });

        function updateThemeIcon(theme) {
          themeIcon.textContent = theme === 'dark' ? '☀️' : '🌙';
        }

        function updateLanguageIcon(lang) {
          // Update active button based on language
          langToggle.querySelectorAll('.lang-btn').forEach((btn) => {
            btn.classList.remove('active');
            if (btn.getAttribute('data-lang') === lang) {
              btn.classList.add('active');
            }
          });
        }

        function updateNavigation(lang) {
          const navLinks = document.querySelectorAll('.nav-link');
          const navTexts = {
            ko: ['홈', '업체 목록', '지도', '게시판', '업체 등록', '가이드', '소개'],
            en: ['Home', 'Directory', 'Map', 'Board', 'Submit', 'Guide', 'About'],
          };

          navLinks.forEach((link, index) => {
            if (navTexts[lang] && navTexts[lang][index]) {
              link.textContent = navTexts[lang][index];
            }
          });
        }

        // Scroll to top functionality
        const scrollToTopBtn = document.getElementById('scrollToTop');

        window.addEventListener('scroll', function () {
          if (window.pageYOffset > 300) {
            scrollToTopBtn.classList.add('show');
          } else {
            scrollToTopBtn.classList.remove('show');
          }
        });

        scrollToTopBtn.addEventListener('click', function () {
          window.scrollTo({
            top: 0,
            behavior: 'smooth',
          });
        });
      });
    </script>
  </body>
</html>
